-- 2025-12-05
database : springdb
username : springuser
password : mysql

-- DB ����
create database springdb;

-- user

use mysql;

create user 'springuser'@'localhost' identified by 'mysql';
grant all privileges on springdb.* to 'springuser'@'localhost';
flush privileges;

use springdb;

create table board(
bno bigint not null auto_increment,
title varchar(200) not null,
writer varchar(200) not null,
content text,
is_del varchar(5) default 'N',
reg_date datetime default now(),
read_count int default 0,
primary key(bno));

--25-12-08
create table comment(
cno bigint auto_increment,
bno bigint not null,
writer varchar(200) not null,
content text,
reg_date datetime default now(),
primary key(cno)
);

-- 25-12-09
-- board 댓글 개수를 집계하는 칼럼을 추가
alter table board add cmt_qty int default 0;
-- 현재 들어간 댓글 갯수 집계
UPDATE board b
LEFT JOIN (
    SELECT bno, COUNT(*) AS cnt
    FROM comment
    GROUP BY bno
) c ON b.bno = c.bno
SET b.cmt_qty = IFNULL(c.cnt, 0);

-- update board b set cmt_qty = (
-- 	select count(cno) from comment c
-- 	where b.bno = c.bno
-- );

-- 25-12-10
-- not null을 사용하면 데이터가 가지 않으면 에러가 발생함
-- 데이터를 반드시 부여해줘야 함
create table file(
uuid varchar(256) not null,
save_dir varchar(256) not null,
file_name varchar(256) not null,
file_type tinyint(1) default 0,
bno bigint not null,
file_size bigint,
reg_date datetime default now(),
primary key(uuid)
);

-- 25-12-11
-- board 테이블에 파일의 개수를 집계하는 칼럼을 추가
alter table board add file_qty int default 0;

-- 현재 들어가 있는 파일의 개수를 집계
update board b set file_qty = (
  select count(uuid) from file f
  where b.bno = f.bno
);

